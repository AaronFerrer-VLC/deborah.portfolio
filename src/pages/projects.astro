---
import PageLayout from "../layouts/PageLayout.astro";
import { AddProject } from "@/components/AddProject";
import { supabase } from "../lib/supabase";
import ProjectDisplay from "@/components/ProjectDisplay.astro";

const accessToken = Astro.cookies.get("sb-access-token");
const refreshToken = Astro.cookies.get("sb-refresh-token");

let session;
try {
  session = await supabase.auth.setSession({
    refresh_token: refreshToken?.value || "",
    access_token: accessToken?.value || "",
  });
} catch (error) {
  return;
}

const email = session.data.user?.email;
---

<PageLayout title="Projects" header="Projects">
  <ProjectDisplay />
  <AddProject client:load email={email || ""} />
</PageLayout>
